(function(){"use strict";var I="LADB-2026-EDLEY-7X9K2",E="1.1.0",A="20260128",k="Q29weXJpZ2h0IDIwMjYgQnJhbmRvbiBFZGxleS4gTGljZW5zZWQgZm9yIExBIE9SRVMgb25seS4=",d=document.currentScript||document.querySelector("script[data-la-bridge]");if(!d){console.error("[LA-Bridge] Could not find script element. Add data-la-bridge attribute.");return}var i={measurementId:d.dataset.measurementId||null,mode:d.dataset.mode||"auto",eventPrefix:d.dataset.eventPrefix||"la_",allowedOrigins:(d.dataset.allowedOrigins||"https://book.mylimobiz.com").split(",").map(function(t){return t.trim()}),debug:d.dataset.debug==="true",iframeSelector:d.dataset.iframeSelector||'iframe[src*="book.mylimobiz.com"]',minHeight:parseInt(d.dataset.minHeight,10)||400,maxHeight:parseInt(d.dataset.maxHeight,10)||2e3,enableHeightResize:d.dataset.enableHeightResize!=="false"};function r(){if(i.debug){var t=["[LA-Bridge]"].concat(Array.prototype.slice.call(arguments));console.log.apply(console,t)}}r("Config loaded:",i);var s=i.mode,u=i.measurementId;function f(){if(window.dataLayer&&Array.isArray(window.dataLayer))for(var t=0;t<window.dataLayer.length;t++){var e=window.dataLayer[t];if(e&&e[0]==="config"&&typeof e[1]=="string"&&e[1].startsWith("G-"))return e[1]}if(window.google_tag_data&&window.google_tag_data.tidr){for(var a=Object.keys(window.google_tag_data.tidr),n=0;n<a.length;n++)if(a[n].startsWith("G-"))return a[n]}return null}function c(){i.mode==="gtag"||i.mode==="dataLayer"?s=i.mode:i.measurementId?s="gtag":typeof window.gtag=="function"?(s="gtag",u=f()):s="dataLayer",r("Resolved mode:",s,"Measurement ID:",u||"(auto)")}var _={purchase:{name:"purchase",params:["transaction_id","value","currency","items","coupon","shipping","tax","booking_type","is_quote"]},begin_checkout:{name:"begin_checkout",params:["value","currency","items","coupon","booking_type","is_quote"]},add_to_cart:{name:"add_to_cart",params:["value","currency","items","booking_type","is_quote"]},view_item:{name:"view_item",params:["value","currency","items","booking_type","is_quote"]},view_item_list:{name:"view_item_list",params:["item_list_id","item_list_name","items","booking_type","is_quote"]},select_item:{name:"select_item",params:["item_list_id","item_list_name","items","value","currency","booking_type","is_quote"]},add_payment_info:{name:"add_payment_info",params:["value","currency","payment_type","items","coupon","booking_type","is_quote"]},add_shipping_info:{name:"add_shipping_info",params:["value","currency","shipping_tier","items","coupon","booking_type","is_quote"]},add_contact_info:{name:"add_contact_info",params:["booking_type","is_quote"]},form_start:{name:"form_start",params:["form_id","form_name","form_destination","first_field"]},generate_lead:{name:"generate_lead",params:["value","currency","lead_source","transaction_id","booking_type","is_quote"]}};function p(t,e){if(typeof window.gtag!="function")return r("gtag not available, falling back to dataLayer"),l(t,e),!1;var a={},n=_[t];n?n.params.forEach(function(o){e[o]!==void 0&&(a[o]=e[o])}):(a=Object.assign({},e),delete a.event),u&&(a.send_to=u),r("Firing gtag:",t,a);try{return window.gtag("event",t,a),!0}catch(o){return r("gtag error:",o),l(t,e),!1}}function l(t,e){window.dataLayer=window.dataLayer||[];var a=i.eventPrefix+t,n={event:a};return Object.keys(e).forEach(function(o){o!=="event"&&(n[i.eventPrefix+o]=e[o])}),r("Pushing to dataLayer:",n),window.dataLayer.push(n),!0}function v(t,e){return r("Handling event:",t,e),e&&e._debug_only?(delete e._debug_only,l(t,e)):s==="gtag"?p(t,e):l(t,e)}var g=null;function y(){return g&&document.contains(g)||(g=document.querySelector(i.iframeSelector)),g}function h(t){if(!i.enableHeightResize){r("Height resize disabled, ignoring height:",t);return}var e=y();if(!e){r("No iframe found with selector:",i.iframeSelector);return}var a=Math.max(i.minHeight,Math.min(i.maxHeight,t));e.style.height=a+"px",r("Updated iframe height:",a,"(raw:",t+")")}var m={};function w(t){return i.allowedOrigins.indexOf("*")!==-1?!0:i.allowedOrigins.indexOf(t)!==-1}function b(t){if(w(t.origin)){var e=t.data;if(!(!e||!e.type)){if(e.type==="LA_IFRAME_HEIGHT"){typeof e.height=="number"&&e.height>0&&h(e.height);return}if(e.type==="LA_DATALAYER_EVENT"){var a=e.payload;if(!a||!a.eventName){r("Invalid payload:",e);return}if(!a.eventName.startsWith("gtm.")){var n=a.timestamp+"_"+a.eventName;if(m[n]){r("Duplicate event skipped:",a.eventName);return}m[n]=!0;var o=Object.keys(m);o.length>100&&delete m[o[0]],r("Received from",t.origin+":",a.eventName),v(a.eventName,a.data||{})}}}}}function L(){c(),window.addEventListener("message",b,!1),r("Receiver initialized. Listening for events from:",i.allowedOrigins.join(", ")),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:i.eventPrefix+"bridge_ready",la_bridge_mode:s,la_bridge_measurement_id:u||"auto"})}L()})();

!function(){"use strict";var e="LADB-2026-EDLEY-7X9K2",t="1.1.0",a="20260128",i="Q29weXJpZ2h0IDIwMjYgQnJhbmRvbiBFZGxleS4gTGljZW5zZWQgZm9yIExBIE9SRVMgb25seS4=",n=document.currentScript||document.querySelector("script[data-la-bridge]");if(n){var r={measurementId:n.dataset.measurementId||null,mode:n.dataset.mode||"auto",eventPrefix:n.dataset.eventPrefix||"la_",allowedOrigins:(n.dataset.allowedOrigins||"https://book.mylimobiz.com").split(",").map(function(e){return e.trim()}),debug:"true"===n.dataset.debug,iframeSelector:n.dataset.iframeSelector||'iframe[src*="book.mylimobiz.com"]',minHeight:parseInt(n.dataset.minHeight,10)||400,maxHeight:parseInt(n.dataset.maxHeight,10)||2e3,enableHeightResize:"false"!==n.dataset.enableHeightResize};u("Config loaded:",r);var o=r.mode,d=r.measurementId,g={purchase:{name:"purchase",params:["transaction_id","value","currency","items","coupon","shipping","tax","booking_type","is_quote"]},generate_lead:{name:"generate_lead",params:["value","currency","lead_source","transaction_id","booking_type","is_quote"]}},s=null,l={};b()}else console.error("[LA-Bridge] Could not find script element. Add data-la-bridge attribute.");function u(){if(r.debug){var e=["[LA-Bridge]"].concat(Array.prototype.slice.call(arguments));console.log.apply(console,e)}}function m(){if(window.dataLayer&&Array.isArray(window.dataLayer))for(var e=0;e<window.dataLayer.length;e++){var t=window.dataLayer[e];if(t&&"config"===t[0]&&"string"==typeof t[1]&&t[1].startsWith("G-"))return t[1]}if(window.google_tag_data&&window.google_tag_data.tidr)for(var a=Object.keys(window.google_tag_data.tidr),i=0;i<a.length;i++)if(a[i].startsWith("G-"))return a[i];return null}function c(){"gtag"===r.mode||"dataLayer"===r.mode?o=r.mode:r.measurementId?o="gtag":"function"==typeof window.gtag?(o="gtag",d=m()):o="dataLayer",u("Resolved mode:",o,"Measurement ID:",d||"(auto)")}function f(e,t){if("function"!=typeof window.gtag)return u("gtag not available, falling back to dataLayer"),y(e,t),!1;var a={},i=g[e];i?i.params.forEach(function(e){void 0!==t[e]&&(a[e]=t[e])}):delete(a=Object.assign({},t)).event,d&&(a.send_to=d),u("Firing gtag:",e,a);try{return window.gtag("event",e,a),!0}catch(a){return u("gtag error:",a),y(e,t),!1}}function y(e,t){window.dataLayer=window.dataLayer||[];var a,i={event:r.eventPrefix+e};return Object.keys(t).forEach(function(e){"event"!==e&&(i[r.eventPrefix+e]=t[e])}),u("Pushing to dataLayer:",i),window.dataLayer.push(i),!0}function v(e,t){return u("Handling event:",e,t),t&&t._debug_only?(delete t._debug_only,y(e,t)):"gtag"===o?f(e,t):y(e,t)}function h(){return s&&document.contains(s)?s:s=document.querySelector(r.iframeSelector)}function w(e){if(r.enableHeightResize){var t=h();if(t){var a=Math.max(r.minHeight,Math.min(r.maxHeight,e));t.style.height=a+"px",u("Updated iframe height:",a,"(raw:",e+")")}else u("No iframe found with selector:",r.iframeSelector)}else u("Height resize disabled, ignoring height:",e)}function p(e){return-1!==r.allowedOrigins.indexOf("*")||-1!==r.allowedOrigins.indexOf(e)}function _(e){if(p(e.origin)){var t=e.data;if(t&&t.type)if("LA_IFRAME_HEIGHT"!==t.type){if("LA_DATALAYER_EVENT"===t.type){var a=t.payload;if(a&&a.eventName){if(!a.eventName.startsWith("gtm.")){var i=a.timestamp+"_"+a.eventName;if(l[i])u("Duplicate event skipped:",a.eventName);else{l[i]=!0;var n=Object.keys(l);n.length>100&&delete l[n[0]],u("Received from",e.origin+":",a.eventName),v(a.eventName,a.data||{})}}}else u("Invalid payload:",t)}}else"number"==typeof t.height&&t.height>0&&w(t.height)}}function b(){c(),window.addEventListener("message",_,!1),u("Receiver initialized. Listening for events from:",r.allowedOrigins.join(", ")),window.dataLayer=window.dataLayer||[],window.dataLayer.push({event:r.eventPrefix+"bridge_ready",la_bridge_mode:o,la_bridge_measurement_id:d||"auto"})}}();